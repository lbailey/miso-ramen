@(title: String)(content: Html)(implicit toolbar : models.Secure.Toolbar)
@import helper._

<!DOCTYPE html>

<html>
    <head>
        <title>@title</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" media="screen" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.4.0/fullcalendar.min.css">
        <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
        <!--<link href="@routes.Assets.at("stylesheets/bootstrap.min.css")" rel="stylesheet" media="screen">-->
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/main.css")">
        <link rel="shortcut icon" type="image/png" href="@routes.Assets.at("images/favicon.png")">
        
        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
        <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
        <script src="//ajax.microsoft.com/ajax/jquery.validate/1.7/jquery.validate.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/3.1.62/jquery.inputmask.bundle.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.4.0/fullcalendar.min.js"></script>
        
        <script type="text/javascript" src="https://maps.google.com/maps/api/js?sensor=true"></script>
		<script type="text/javascript" src="https://rawgit.com/HPNeo/gmaps/master/gmaps.js"></script>
		
		<script type="text/javascript" charset="UTF-8" src="http://maps.google.com/maps-api-v3/api/js/22/9a/common.js"></script>
		<script type="text/javascript" charset="UTF-8" src="http://maps.google.com/maps-api-v3/api/js/22/9a/map.js"></script>
		<script type="text/javascript" charset="UTF-8" src="http://maps.google.com/maps-api-v3/api/js/22/9a/util.js"></script>
		<script type="text/javascript" charset="UTF-8" src="http://maps.google.com/maps-api-v3/api/js/22/9a/onion.js"></script>
		<script type="text/javascript" charset="UTF-8" src="http://maps.google.com/maps-api-v3/api/js/22/9a/controls.js"></script>
		<script type="text/javascript" charset="UTF-8" src="http://maps.google.com/maps-api-v3/api/js/22/9a/stats.js"></script>
		<script type="text/javascript" charset="UTF-8" src="http://maps.google.com/maps-api-v3/api/js/22/9a/marker.js"></script>

        <!--<script src="@routes.Assets.at("javascripts/main.js")" type="text/javascript"></script>-->
        
    </head>
    <body>
  
    @nav()
  
	<div id="sticky-bar-anchor"></div>
	<div id="sticky-bar"><span id="gobe-text"></span>
	  <div class="align-right login-wrapper">
	  	@toolbar.user.map { user =>
		@if(toolbar.authorized) {
		<p class="login">
	  	  <span id="helper-text">Logged in as:</span><b> @user </b>&nbsp;
  	  		<a class="logout" href="@routes.Authentication.logout" target="_top">logout</a>
    	</p>
		}
		@if(!toolbar.authorized) {
		<p class="login">    
			<article class="login-form-state">
			@form(action = routes.Authentication.authenticate) {	 	  
			  <input type="username" name="username" placeholder="username" id="username" required />  
			  <input type="password" name="password" placeholder="password" id="password" required />  
			  <input type="submit" id="loginbutton" value="Login">
			  <input type="button" id="signup-button-sticky" value="Sign Up">
			}
			</article>
		</p>
		}}
	  </div>
	</div>
	
    @content
    
    <footer id="footer">
  <p>I'm the Sticky Footer.</p>
    </footer>
    
    </body>

<script type="text/javascript">
        
function sticky_relocate() {
    var window_top = $(window).scrollTop();
    var div_top = $('#sticky-bar-anchor').offset().top;
    if (window_top > div_top) {
        $('#sticky-bar').addClass('stick');
        $("#sticky-bar").animate({ 
        	marginTop: "0px",
      	}, 50 );
    } else {
        $('#sticky-bar').removeClass('stick');
        $('#sticky-bar').css('margin-top','0px');
    }
}

function signup_process() {
    $('#login-prompt').css("visibility","hidden");
    $('#signup-prompt').css("visibility","visible");
    var $marginLefty = $('#signup-prompt');
    $marginLefty.fadeIn(200).animate({
      marginLeft: "-42%",
      left: "0%"
    }, 100 );
}


function check_username() {
    var username = $(this).val();
	$.get("/services/unique/"+username)
	 .done(function(data) {
	    var spanMsg = $('#create-user-login span.form-service-msg');
	    var isTrueSet = (data === 'true');
	    if (isTrueSet) {
	       $('#create-user-login :input[name="username"]')[0].setCustomValidity('');
	       spanMsg.removeClass("red").addClass("green");
	       spanMsg.html("available!");
	    } else {
	       //cannot cast from $(this)
	       $('#create-user-login :input[name="username"]')[0].setCustomValidity(username + ' is not available');
	       spanMsg.addClass("red");
	       spanMsg.html(username + " is not available");
	    }
    });
}

function load_instagram_imgs() {
	$.ajax({
	  method: "GET",
	  dataType: "jsonp",
	  data: { count: 10 },
	  url:	"https://api.instagram.com/v1/tags/gobethe1/media/recent?access_token=529592294.1677ed0.e7958ca06b6e45559ffa9204c1a03421"
	}).done(function(data) {
	    console.log(data);
    })
    .fail(function(data) {
	    console.log(data);    
    });
}


function ready_form_tags() {
    $('ul.sponsor-form-tabs').each(function(){
        var $active, $content, $links = $(this).find('a');
        $active = $($links.filter('[href="'+location.hash+'"]')[0] || $links[0]);
    	$active.addClass('active');

    	$content = $($active[0].hash);
    	$links.not($active).each(function () {
      		$(this.hash).hide();
    	});
    	
    	$(this).on('click', 'a', function(e){
		  $active.removeClass('active');
		  $content.hide();

		  $active = $(this);
		  $content = $(this.hash);

		  $active.addClass('active');
		  $content.show();

		  e.preventDefault();
    	});
    });
}



function ready_homebound_view_toggle() {
    $('#homebound-viewer p.listing-text').each(function(){
        var $expanded = $(this);
        var $names = $(this).find('#name');
        $names.on('click', function(e){
          console.log('click');
          if ($expanded.hasClass("expanded")) {
		     $expanded.removeClass('expanded');
		     $expanded.addClass('collapsed');
		  } else if ($expanded.hasClass("collapsed")) {
		     $expanded.addClass('expanded');
		     $expanded.removeClass('collapsed');
		  }
		  e.preventDefault();
    	});
    });
}


function image_mosiac() {
    $(".image-block").each(function(i) {
       $(this).delay((i + 1) * 100).fadeIn();
    }).delay(1000).queue(function(nxt) {
      $('#non-sponsor-prompt').fadeIn("slow");
      $('#content-block-wrapper').stop().animate({
         marginTop: "300px"
       }, 200 );
        $('#footer').fadeIn();
       nxt();
	});
}


function mask_phone_fields() {  
    var phones = [{ "mask": "(###) ###-####"}];
    $('#org-phone').inputmask({ 
        mask: phones, 
        greedy: false, 
        definitions: { '#': { validator: "[0-9]", cardinality: 1}} });   
    $('#indv-phone').inputmask({ 
        mask: phones, 
        greedy: false, 
        definitions: { '#': { validator: "[0-9]", cardinality: 1}} }); 
    $('#hm-phone').inputmask({ 
        mask: phones, 
        greedy: false, 
        definitions: { '#': { validator: "[0-9]", cardinality: 1}} });   
}


function sponsor_form_slide() {
    $('#non-sponsor-prompt').css("visibility","hidden");
    $('#sponsor-form-prompt').show().animate({
        marginLeft: "-42%",
        left: "0%"
        }, 300).queue(function(nxt) {
          $('#image-grid-container').css({'overflow': 'auto'});
          nxt();
        }).queue(function(nxt) {
        	$('html, body').animate({
        	  scrollTop: $("#sponsor-form-prompt").offset().top - 80
    	      }, 500);
    		nxt();
    });
}

function partner_form_slide() {
    $('#partner-prompt').css("visibility","hidden");
    $('#partner-form-prompt').show().animate({
        marginLeft: "-42%",
        left: "0%"
        }, 300);
}

function geolocate_address() {  
    var zipcode = $(this).val();
    var $parentForm = $(this).parent().closest('form');
    var street = $parentForm.find('input[name="street"]').val();
    var city = $parentForm.find('input[name="city"]').val();
    var queryString = street.replace(/ /g, '+') + ",+" + city.replace(/ /g, '+') + ",+" + zipcode;
    console.log(queryString);
    
	$.ajax({
	  method: "GET",
	  dataType: "json",
	  data: {
	    address: queryString,
	    key: "AIzaSyAgCRPGtzMTNktJqiERFZOqOQs7SecCW-Q"
	  },
	  url:	"https://maps.googleapis.com/maps/api/geocode/json"
	}).done(function(data) {
	    console.log(data);
	    var res = data.results[0];
	    console.log(res);
		$parentForm.find('input[name="workingAddress"]').val(res.formatted_address);
		$parentForm.find('input[name="homeAddress"]').val(res.formatted_address);
		$parentForm.find('input[name="location.latitude"]').val(res.geometry.location.lat);
		$parentForm.find('input[name="location.longitude"]').val(res.geometry.location.lng);
    })
    .fail(function(data) {
	    console.log(data);    
    });
    
}

function edit_button_toggle() {
   var $form = $(this).parent().parent().find("form");
   $form.toggle(!$form.is(':visible'));
}


$(document).ready(function(){

    @if((toolbar.authorized && toolbar.profile.isDefined) || toolbar.isAdmin ) {
      $("#footer").show();
    }

    $(window).scroll(sticky_relocate);
    sticky_relocate();  
    $("#signup-button-top").bind("click", signup_process);
    $("#signup-button-sticky").bind("click", signup_process);
    $('#create-user-login :input[name="username"]').on( "focusout", check_username);  
    
    
    /****   Specifically for empty Sponsor Dashboard, not Admin Dash or regular Dash  ***/
	//load_instagram_imgs();
	    
    $('.image-block').hide();
    ready_form_tags();
    
    $("#proceed-to-sponsor").bind("click", sponsor_form_slide);
    $('#sponsor-form-prompt :input[name="zip"]').on( "focusout", geolocate_address );
    
    $('#homebound-entry :input[name="zip"]').on( "focusout", geolocate_address );
    $('#create-homebound').on('submit', function(e) {
        e.preventDefault();
        $.ajax({
            url : $(this).attr('action'),
            type: "POST",
            data: $(this).serialize(),
            success: function (data) {
              console.log("success!");
              $('#homebound-viewer').load(location.href+" #homebound-viewer>*","");
              $('#create-homebound').trigger("reset");
              ready_homebound_view_toggle();
            },
            error: function (jXHR, textStatus, errorThrown) {
                alert(errorThrown);
            }
        });
    });
    
    
    $('#tools-update-sponsor :input[name="zip"]').on( "focusout", geolocate_address );
    $("#edit-user-data").bind("click", edit_button_toggle);
    $("#edit-sponsor-data").bind("click", edit_button_toggle);
    
    $("#proceed-to-partner-form").bind("click", partner_form_slide);

});

$(window).load(function() {

	
    $("#login-prompt").fadeIn("slow");
    image_mosiac();
    mask_phone_fields();
    
    /* On Entry Form Page */
    $("#homebound-entry").fadeIn("slow").queue(function(nxt) {
      $('#homebound-viewer').fadeIn("slow");
      nxt();
    });
    
    ready_homebound_view_toggle();
    
    /* On Guidelines Form Page */
    $("#guidelines-left").fadeIn().queue(function(nxt) {
      $("#guidelines-right").fadeIn();
      nxt();
    });

});

</script>
</html>




